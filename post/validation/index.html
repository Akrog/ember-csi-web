
<!DOCTYPE HTML>

<html>
	<head>
    <title>Ember CSI</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <link rel="stylesheet" href="https://ember-csi.io/assets/css/main.css" />
    
    <meta name="generator" content="Hugo 0.45.1" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ember-csi.io/images/01-post-thumb.jpg"/>

<meta name="twitter:title" content="Driver validation"/>
<meta name="twitter:description" content="Are you interested in Ember-CSI and want to know if your storage backend works with it? Then this article is for you. We present a step by step guide to validate a backend in Ember-CSI. From getting the right configuration to creating and using volumes in containers on a Kubernetes cluster using your backend via Ember-CSI."/>
<meta name="twitter:site" content="@ember_csi"/>

    <link href="https://fonts.googleapis.com/css?family=Pattaya" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="https://ember-csi.io/images/ember.svg">
    <link rel="icon" href="https://ember-csi.io/images/icon192.png">

</head>

	<body class="homepage">
		<div id="page-wrapper">

			
			<div id="header-wrapper">
				<div id="header">

                    <section id="top_page">
					
<div>
<h1><a href="https://ember-csi.io/"><img src="/images/ember.svg" height=64/> EMBER</a></h1>
<h2>Unified Storage Plugin for Containers</h2>
</div>

					
<div>
<nav id="nav">
    <ul>
            <li><a href='https://twitter.com/ember_csi' title='Twitter'><i class="fa fa-twitter"></i></a></li>
            <li><a href='https://kiwiirc.com/client/irc.freenode.net/ember-csi' title='IRC'><i class="fa fa-hashtag"></i></a></li>
            <li><a href='https://groups.google.com/forum/#!forum/embercsi' title='Forum & Mailing list'><i class="fa fa-comments"></i></a></li>
            <li><a href='https://github.com/embercsi/ember-csi' title='Code'><i class="fa fa-github"></i></a></li>
            <li><a href='http://docs.ember-csi.io' title='Documentation'><i class="fa fa-book"></i></a></li>
    </ul>
</nav>
</div>

                    </section>

				</div>
			</div>

			
			<div id="main-wrapper">
				<div class="container">
					
					
<article class="box post">
    <a href="#" class="image featured"><img src="https://ember-csi.io/images/01-post.jpg" alt="" /></a>
    <header>
        <h2>Driver validation</h2>
        
        <p>April 10, 2019 - last updated April 24, 2019</p>
        
    </header>
    

<p>The Ember-CSI team is frequently asked about the supported backends and how to test Ember-CSI with a specific one.  In some cases the answer is straightforward, in other cases it&rsquo;s considerably more complex, so we thought it would be a good idea to write an article with all this knowledge, including a step by step guide on how we can validate that a backend works with Ember-CSI.</p>

<p>For the final validation we will be using <a href="https://github.com/embercsi/ember-csi/tree/master/examples/k8s_v1.13-CSI_v1.0">Ember-CSI&rsquo;s Kubernetes example</a> to deploy a 3 nodes Kubernetes cluster with 1 infrastructure node a 2 workload nodes.</p>

<h3 id="supported-drivers">Supported drivers</h3>

<p>Ember-CSI should support most of the drivers listed in the <a href="https://docs.openstack.org/cinder/latest/configuration/block-storage/volume-drivers.html">Cinder drivers page</a>, but the Ember-CSI team has only tested the plugin with a limited set of backends:</p>

<ul>
<li>LVM (iSCSI)</li>
<li>Ceph (RBD)</li>
<li>Dell EMC XtremIO (iSCSI)</li>
<li>Kaminario K2 (iSCSI)</li>
<li>QNAP TS-831X (iSCSI)</li>
<li>NetApp (iSCSI)</li>
</ul>

<p>We have also received confirmation from other people that indicates that there&rsquo;s also compatibilty with other backends, such as:</p>

<ul>
<li>NetApp SolidFire (iSCSI)</li>
<li>Dell EMC VMAX (iSCSI)</li>
<li>Synology DS916+</li>
</ul>

<p>So if you are looking to test Ember-CSI with any of these backends, then you are in luck, as you should be able to skip most of the steps described in this guide and, with some small changes to set your backend configuration, you&rsquo;ll be able to try out Ember-CSI.</p>

<p>You may be asking yourselves, what happens if my backend is not in any of these two lists?  How can you claim that there are over 80 storage drivers supported with such a small list?</p>

<p>To answer these, and hopefully other questions you may have, we will go over some Ember-CSI implementation details to explain how it supports so many different backends from different vendors.</p>

<p>We can get the full list of available drivers as a JSON list from the Ember-CSI container itself:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run -it --rm embercsi/ember-csi:master ember-list-drivers
<span style="color:#f92672">[</span>
    <span style="color:#e6db74">&#34;ACCESSIscsi&#34;</span>,
    <span style="color:#e6db74">&#34;DPLFC&#34;</span>,
    <span style="color:#e6db74">&#34;DPLISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;DSWARE&#34;</span>,
    <span style="color:#e6db74">&#34;Disco&#34;</span>,
    <span style="color:#e6db74">&#34;DrbdManageDrbd&#34;</span>,
    <span style="color:#e6db74">&#34;DrbdManageIscsi&#34;</span>,
    <span style="color:#e6db74">&#34;EMCCoprHDFC&#34;</span>,
    <span style="color:#e6db74">&#34;EMCCoprHDISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;EMCCoprHDScaleIO&#34;</span>,
    <span style="color:#e6db74">&#34;FJDXFC&#34;</span>,
    <span style="color:#e6db74">&#34;FJDXISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;FibreChannelVolume&#34;</span>,
    <span style="color:#e6db74">&#34;FlashSystemFC&#34;</span>,
    <span style="color:#e6db74">&#34;FlashSystemISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;GPFS&#34;</span>,
    <span style="color:#e6db74">&#34;GPFSNFS&#34;</span>,
    <span style="color:#e6db74">&#34;GPFSRemote&#34;</span>,
    <span style="color:#e6db74">&#34;HGST&#34;</span>,
    <span style="color:#e6db74">&#34;HPE3PARFC&#34;</span>,
    <span style="color:#e6db74">&#34;HPE3PARISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;HPELeftHandISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;HPMSAFC&#34;</span>,
    <span style="color:#e6db74">&#34;HPMSAISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;HuaweiFC&#34;</span>,
    <span style="color:#e6db74">&#34;HuaweiISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;HyperScale&#34;</span>,
    <span style="color:#e6db74">&#34;IBMStorage&#34;</span>,
    <span style="color:#e6db74">&#34;ISCSIVolume&#34;</span>,
    <span style="color:#e6db74">&#34;InStorageMCSFC&#34;</span>,
    <span style="color:#e6db74">&#34;InStorageMCSISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;KaminarioISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;LVMVolume&#34;</span>,
    <span style="color:#e6db74">&#34;LenovoFC&#34;</span>,
    <span style="color:#e6db74">&#34;LenovoISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;MStorageFC&#34;</span>,
    <span style="color:#e6db74">&#34;MStorageISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;NetAppCmodeFibreChannel&#34;</span>,
    <span style="color:#e6db74">&#34;NetAppCmodeISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;NetAppCmodeNfs&#34;</span>,
    <span style="color:#e6db74">&#34;NetAppEseriesFibreChannel&#34;</span>,
    <span style="color:#e6db74">&#34;NetAppEseriesISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;NexentaEdgeISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;NexentaISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;NexentaNfs&#34;</span>,
    <span style="color:#e6db74">&#34;Nfs&#34;</span>,
    <span style="color:#e6db74">&#34;NimbleFC&#34;</span>,
    <span style="color:#e6db74">&#34;NimbleISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;PSSeriesISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;PureFC&#34;</span>,
    <span style="color:#e6db74">&#34;PureISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;QnapISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;Quobyte&#34;</span>,
    <span style="color:#e6db74">&#34;RBD&#34;</span>,
    <span style="color:#e6db74">&#34;SCFC&#34;</span>,
    <span style="color:#e6db74">&#34;SCISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;ScaleIO&#34;</span>,
    <span style="color:#e6db74">&#34;Sheepdog&#34;</span>,
    <span style="color:#e6db74">&#34;SolidFire&#34;</span>,
    <span style="color:#e6db74">&#34;StorPool&#34;</span>,
    <span style="color:#e6db74">&#34;StorwizeSVCFC&#34;</span>,
    <span style="color:#e6db74">&#34;StorwizeSVCISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;SynoISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;Tintri&#34;</span>,
    <span style="color:#e6db74">&#34;Unity&#34;</span>,
    <span style="color:#e6db74">&#34;VMAXFC&#34;</span>,
    <span style="color:#e6db74">&#34;VMAXISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;VMwareVStorageObject&#34;</span>,
    <span style="color:#e6db74">&#34;VMwareVcVmdk&#34;</span>,
    <span style="color:#e6db74">&#34;VNX&#34;</span>,
    <span style="color:#e6db74">&#34;VZStorage&#34;</span>,
    <span style="color:#e6db74">&#34;VeritasCNFS&#34;</span>,
    <span style="color:#e6db74">&#34;WindowsISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;WindowsSmbfs&#34;</span>,
    <span style="color:#e6db74">&#34;XtremIOFC&#34;</span>,
    <span style="color:#e6db74">&#34;XtremIOISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;ZFSSAISCSI&#34;</span>,
    <span style="color:#e6db74">&#34;ZFSSANFS&#34;</span>,
    <span style="color:#e6db74">&#34;ZadaraVPSAISCSI&#34;</span>
<span style="color:#f92672">]</span></code></pre></div>
<h3 id="implementation-details">Implementation details</h3>

<p>Ember-CSI leverages two different projects to manage all the different storage backends.  One project called <a href="https://docs.openstack.org/cinder">Cinder</a> for the low level storage drivers, and another project called <a href="https://docs.openstack.org/cinderlib">cinderlib</a> to provide an object oriented abstraction on top of the drivers as well as a plugin mechanism to store the metadata of the different resources (volume, snapshots, attachments, etc.).</p>

<p>The <a href="https://docs.openstack.org/cinder">Cinder</a> project is much more than just a group of storage drivers, it is the Block Storage service within the <a href="https://www.openstack.org">OpenStack</a> cloud operating system.  As such, its drivers were not expected to be used outside of the <a href="https://docs.openstack.org/cinder">Cinder</a> itself, so they were tightly coupled to the Cinder-volume service itself.</p>

<p>Here is where the <a href="https://docs.openstack.org/cinderlib">cinderlib</a> project comes in.  It resolves the existing issues around using the <a href="https://docs.openstack.org/cinder">Cinder</a> drivers outside of <a href="https://www.openstack.org">OpenStack</a> and provides an object oriented abstraction of these drivers in a single library that can be used from any Python program.</p>

<p>There were many issues that <a href="https://docs.openstack.org/cinderlib">cinderlib</a> had to solve, some of which were driver specific, and that&rsquo;s why unless we have access to the hardware, it is not currently possible to guarantee that a driver works with <a href="https://docs.openstack.org/cinderlib">cinderlib</a>, even if the driver is in the <a href="https://docs.openstack.org/cinder">Cinder</a> repository.  The library may require additional changes to work, or the driver may have a bug that doesn&rsquo;t affect <a href="https://docs.openstack.org/cinder">Cinder</a> but it does <a href="https://docs.openstack.org/cinderlib">cinderlib</a>.  The <a href="https://docs.openstack.org/cinderlib">cinderlib</a> project is now part of <a href="https://www.openstack.org">OpenStack</a> and is in the process of adding its functional tests to the existing vendor specific CIs in the <a href="https://docs.openstack.org/cinder">Cinder</a> project itself.  Once this is done, we will be able to easily confirm that Ember-CSI works with those backends, since any driver that works with <a href="https://docs.openstack.org/cinderlib">cinderlib</a> will work with Ember-CSI (provided external dependencies are present, more on this later).</p>

<p>Knowing that <a href="https://docs.openstack.org/cinderlib">cinderlib</a> compatibility of our backend is the key for Ember-CSI to support a storage backend, we propose a cautious approach to validating drivers that have not yet been tested.  It starts by testing the compatibility with <a href="https://docs.openstack.org/cinderlib">cinderlib</a> itself first, and for that we&rsquo;ll need to first define our driver&rsquo;s configuration.</p>

<h3 id="driver-configuration-parameters">Driver configuration parameters</h3>

<p>There are 2 ways to come up with the storage driver configuration to test <a href="https://docs.openstack.org/cinderlib">cinderlib</a> compatibility:</p>

<ol>
<li>Automatically from an existing <code>cinder.conf</code> file.</li>
<li>Manually from <a href="https://docs.openstack.org/cinder">Cinder</a>&rsquo;s or the vendor&rsquo;s documentation.</li>
</ol>

<h4 id="automatically">Automatically</h4>

<p>If we have a valid <code>cinder.conf</code> file for our storage backend, we can use the <a href="https://docs.openstack.org/cinderlib">cinderlib</a> tool called <code>cinder_cfg_to_cinderlib_code.py</code> to generate Python code with the proper <a href="https://docs.openstack.org/cinderlib">cinderlib</a> <code>Backend</code> initialization.</p>

<p>Here&rsquo;s an example of running the tool with an LVM backend:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cat cinder.conf
<span style="color:#f92672">[</span>DEFAULT<span style="color:#f92672">]</span>
enabled_backends <span style="color:#f92672">=</span> lvm

<span style="color:#f92672">[</span>lvm<span style="color:#f92672">]</span>
volume_backend_name <span style="color:#f92672">=</span> lvm
volume_driver <span style="color:#f92672">=</span> cinder.volume.drivers.lvm.LVMVolumeDriver
volume_group <span style="color:#f92672">=</span> cinder-volumes
target_protocol <span style="color:#f92672">=</span> iscsi
target_helper <span style="color:#f92672">=</span> lioadm

$ cp cinder.conf /tmp/cinder.conf

$ docker run -it --rm -v /tmp/cinder.conf:/etc/cinder/cinder.conf:ro embercsi/ember-csi:master python -m cinderlib.cmd.cinder_cfg_to_python
import cinderlib as cl

lvm <span style="color:#f92672">=</span> cl.Backend<span style="color:#f92672">(</span>target_protocol<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;iscsi&#34;</span>, volume_driver<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder.volume.drivers.lvm.LVMVolumeDriver&#34;</span>, volume_backend_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lvm&#34;</span>, volume_group<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder-volumes&#34;</span>, target_helper<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lioadm&#34;</span><span style="color:#f92672">)</span>

$ rm /tmp/cinder.conf</code></pre></div>
<p>In the <code>docker run</code> output we can see the Python code that initializes our LVM backend, and in the call to the <code>Backend</code> class we have the <a href="https://docs.openstack.org/cinderlib">cinderlib</a> configuration that will allow us to control our backend.</p>

<p>With this we can now proceed to verify our backend driver&rsquo;s compatibility with <a href="https://docs.openstack.org/cinderlib">cinderlib</a>.</p>

<p>This conversion tool supports <code>cinder.conf</code> files with multiple backends.  When there are multiple backends defined in the <code>enabled_backends</code> section we will see multiple <code>Backend</code> instances being assigned to Python variables.</p>

<h4 id="manually">Manually</h4>

<p>If we don&rsquo;t have a <code>cinder.conf</code> file we can use to extract the configuration parameters we will have to rely on <a href="https://docs.openstack.org/cinder/rocky/configuration/block-storage/volume-drivers.html">Cinder&rsquo;s driver configuration reference</a> to manually create the parameters.</p>

<p>For example, if we go to the <a href="https://docs.openstack.org/cinder/rocky/configuration/block-storage/drivers/ceph-rbd-volume-driver.html">Ceph RADOS Block Device (RBD)</a> we can see it has a <a href="https://docs.openstack.org/cinder/rocky/configuration/block-storage/drivers/ceph-rbd-volume-driver.html#driver-options">Driver options section</a>.</p>

<p>From this section we can see we have the following configuration options:</p>

<ul>
<li>rados_connect_timeout</li>
<li>rados_connection_interval</li>
<li>rados_connection_retries</li>
<li>rbd_ceph_conf</li>
<li>rbd_cluster_name</li>
<li>rbd_exclusive_cinder_pool</li>
<li>rbd_flatten_volume_from_snapshot</li>
<li>rbd_keyring_conf</li>
<li>rbd_max_clone_depth</li>
<li>rbd_pool</li>
<li><del>rbd_secret_uuid</del></li>
<li>rbd_store_chunk_size</li>
<li>rbd_user</li>
<li><del>replication_connect_timeout</del></li>
<li>report_dynamic_total_capacity</li>
</ul>

<p>Since <a href="https://docs.openstack.org/cinderlib">cinderlib</a> doesn&rsquo;t support replication we can ignore <code>replication_connect_timeout</code>, and since the <code>rbd_secret_uuid</code> is only useful for the <a href="https://www.openstack.org">OpenStack</a> compute service we can ignore it too.</p>

<p>We&rsquo;ll assume most configuration options have reasonable defaults, which is a reasonable assumption, and focus only on the parameters that will depend on our specific backend: <code>rbd_ceph_conf</code>, <code>rbd_cluster_name</code>, <code>rbd_keyring_conf</code>, <code>rbd_pool</code>, and <code>rbd_user</code>.</p>

<p>Which would leave us with something like the following (it will be different for each deployment):</p>

<ul>
<li><code>rbd_user = admin</code></li>
<li><code>rbd_pool = rbd</code></li>
<li><code>rbd_ceph_conf = /etc/ceph/ceph.conf</code></li>
<li><code>rbd_keyring_conf = /etc/ceph/ceph.client.admin.keyring</code></li>
<li><code>rbd_cluster_name = ceph</code></li>
</ul>

<p>Now, sometimes the documentation is missing things, in this case it does not specify the <code>volume_driver</code> parameter or mention the <code>volume_backend_name</code>.  That is why it is important to know that most vendors will have more extensive documentation on how to configure <a href="https://docs.openstack.org/cinder">Cinder</a> on their websites, so it is always a good idea to Google for such documentation.  For example, in this case we would search for &ldquo;ceph cinder configuration&rdquo; and one of the first links will be to <a href="http://docs.ceph.com/docs/mimic/rbd/rbd-openstack/">the Ceph website</a>, were we can find a <a href="http://docs.ceph.com/docs/mimic/rbd/rbd-openstack/#configuring-cinder">Cinder specific section</a> where the missing parameters <code>volume_driver = cinder.volume.drivers.rbd.RBDDriver</code> and <code>volume_backend_name = ceph</code> are present.  Reminder, the <code>volume_backend_name</code> is an arbitrary name we can chose ourselves and must be unique for all the backends that use the same metadata persistence storage.</p>

<p>You could use this information directly in <a href="https://docs.openstack.org/cinderlib">cinderlib</a>, but we recommend writing this configuration into a small <code>cinder.conf</code> file an proceeding with the automated method described above.  The reason for this is that when doing it manually we will have to make sure that we are formatting the parameters correctly, including strings between double quotes <code>&quot;</code>, complex elements like list between brackets (<code>[</code> and <code>]</code>), etc., whereas with the automated process this will be done for us by the conversion tool, which will also do some validation of the options.</p>

<p>To generate the <code>cinder.conf</code> file we will use the parameters we have, and add the <code>enabled_backends</code> parameter, under the <code>[DEFAULT]</code> section, with whatever name we want to use to describe our backend, and then create a section with that name.  The end result would look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[DEFAULT]</span>
<span style="color:#a6e22e">enabled_backends</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">rbd</span>

<span style="color:#66d9ef">[rbd]</span>
<span style="color:#a6e22e">volume_backend_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">ceph</span>
<span style="color:#a6e22e">volume_driver</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">cinder.volume.drivers.rbd.RBDDriver</span>
<span style="color:#a6e22e">rbd_user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">admin`</span>
<span style="color:#a6e22e">rbd_pool</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">rbd</span>
<span style="color:#a6e22e">rbd_ceph_conf</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/etc/ceph/ceph.conf</span>
<span style="color:#a6e22e">rbd_keyring_conf</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/etc/ceph/ceph.client.admin.keyring</span>
<span style="color:#a6e22e">rbd_cluster_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">ceph</span></code></pre></div>
<p>After writing this into a <code>cinder.conf</code> file we run the <code>cinder-cfg-to-python</code> tool:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cp cinder.conf /tmp/cinder.conf

$ docker run -it --rm -v /tmp/cinder.conf:/etc/cinder/cinder.conf:ro embercsi/ember-csi:master python -m cinderlib.cmd.cinder_cfg_to_python
import cinderlib as cl

ceph <span style="color:#f92672">=</span> cl.Backend<span style="color:#f92672">(</span>rbd_keyring_conf<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/etc/ceph/ceph.client.admin.keyring&#34;</span>, rbd_ceph_conf<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/etc/ceph/ceph.conf&#34;</span>, rbd_cluster_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ceph&#34;</span>, volume_backend_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ceph&#34;</span>, volume_driver<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder.volume.drivers.rbd.RBDDriver&#34;</span>, rbd_pool<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;rbd&#34;</span>, rbd_user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;admin`&#34;</span><span style="color:#f92672">)</span>

$ rm /tmp/cinder.conf</code></pre></div>
<p><strong>For the purpose of validating a driver we recommend not using multipathing until the last step of this guide, where we do a full deployment, so if the output of the configuration includes the line <code>use_multipath_for_image_xfer=True</code> then please change it to <code>False</code> for the following steps.</strong></p>

<h3 id="driver-compatibility">Driver compatibility</h3>

<p>Now that we have the driver configuration we will go ahead and confirm that our driver configuration is valid while checking the driver&rsquo;s compatibility with <a href="https://docs.openstack.org/cinderlib">cinderlib</a>.</p>

<p>We can do this in two ways, directly on the host or using a container.  Each one of these approaches has its own advantages and disadvantages.  The best approach is probably fail and error, where we first try with the container approach, and if we encounter difficulties we can&rsquo;t figure out we fall back to the host approach to see if it is related to the mounted volumes and/or container privileges or if it&rsquo;s something else.  If we decide to go with the host approach first, it would be a good idea to also try the containerized way afterwards, as this will help us confirm that the way we are running containers is compatible with the driver.</p>

<p><strong>Our recommendation is to run these commands on a CentOS 7 VM instead of our real host, and use a specific testing pool in you backend to facilitate cleaning things up at the end.  That way we will not pollute our host and we&rsquo;ll also be sure we are not relying on pre-existing packages in our system.</strong></p>

<h4 id="cinderlib-on-the-host">Cinderlib on the host</h4>

<p>For the host approach we will have to install:</p>

<ul>
<li><a href="https://docs.openstack.org/cinder">Cinder</a></li>
<li><a href="https://docs.openstack.org/cinderlib">cinderlib</a></li>
<li>Storage transport tools</li>
<li>Driver specific dependencies</li>
</ul>

<p>We can install <a href="https://docs.openstack.org/cinder">Cinder</a> in 2 different ways, from <a href="https://github.com/openstack/cinder">its repository</a> or using RPM packages.</p>

<p>Assuming the host is a CentOS machine we will use the <a href="https://rdo.org/">RDO</a> RPM packages to install <a href="https://docs.openstack.org/cinder">Cinder</a> using the latest repository to make sure we have the latest version of the Cinder backend driver and cinderlib code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl -o /etc/yum.repos.d/rdo-trunk-runtime-deps.repo https://trunk.rdoproject.org/centos7-master/rdo-trunk-runtime-deps.repo
$ curl -o /etc/yum.repos.d/delorean.repo https://trunk.rdoproject.org/centos7-master/current/delorean.repo
$ sudo yum -y install python-cinderlib</code></pre></div>
<p>Don&rsquo;t be surprised by the number of dependencies pulled by the <code>python-cinderlib</code> package.  We are working on decreasing it by splitting the <code>openstack-cinder</code> package into a common code package that can be used by <a href="https://docs.openstack.org/cinder">Cinder</a> and <a href="https://docs.openstack.org/cinderlib">cinderlib</a>, and having each one of these packages have their independent dependencies.</p>

<p>If our system is not CentOS we can install <a href="https://docs.openstack.org/cinder">Cinder</a> and <a href="https://docs.openstack.org/cinderlib">cinderlib</a> from the repositories to test on the host, though this will not be possible for running it from a container:</p>

<p><strong>This step is not necessary if we already <code>yum</code> installed the RDO package.</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo pip install git+https://github.com/openstack/cinder.git
$ sudo pip install git+https://github.com/openstack/cinderlib.git</code></pre></div>
<p>Now we need to install required storage transport tools.  For example, if our backend uses iSCSI as the transport protocol we would do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum -y install iscsi-initiator-utils
$ sudo systemctl start iscsid</code></pre></div>
<p>Now, with <a href="https://docs.openstack.org/cinder">Cinder</a> and <a href="https://docs.openstack.org/cinderlib">cinderlib</a> installed, we can check the list of available drivers in our system:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ python -c <span style="color:#e6db74">&#39;import cinderlib as cl; print(&#34;\n&#34;.join(cl.list_supported_drivers().keys()))&#39;</span></code></pre></div>
<p>The last step in the preparation of the host is making sure our system has all the external dependencies required by our storage backend driver.  For example Ceph/RBD requires the package <code>ceph-common</code>, 3PAR requires the <code>python-3parclient</code> PyPi package, Pure <code>purestorage</code>, IBM XIV <code>pyxcli</code> and <code>pyOpenSSL</code>.  The <a href="https://docs.openstack.org/cinder">Cinder</a> project keeps a <a href="https://github.com/openstack/cinder/blob/master/driver-requirements.txt">list of PyPi package dependencies by driver</a>, and some drivers also describe these dependencies in their <a href="https://docs.openstack.org/cinder/rocky/configuration/block-storage/volume-drivers.html">OpenStack documentation</a>.</p>

<p>For example, if we were using HPE 3PAR we would do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo pip install <span style="color:#e6db74">&#39;python-3parclient&gt;=4.0,&lt;5.0&#39;</span></code></pre></div>
<p><strong>Note:</strong> It is important to take note of the packages and external files we are adding in order to run cinderlib with our backend, as we&rsquo;ll need it for later.</p>

<p>We are now finally ready to manually test the driver compatibility, and we&rsquo;ll use Python&rsquo;s interactive interpreter and the output of the <code>cinder_cfg_to_python</code> output to create a volume, attach a volume, create a snapshot, delete a snapshot, detach a volume and, finally, delete the volume.</p>

<p><strong>Note:</strong> You must use a user to run the tests that has passwordless <code>sudo</code> privileges or <code>root</code> itself.</p>

<p>Let&rsquo;s have a look at how it looks like for the LVM backend assuming we have already setup the LVM VG beforehand:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> python
Python <span style="color:#ae81ff">2.7</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> (default, Apr <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">2018</span>, <span style="color:#ae81ff">07</span>:<span style="color:#ae81ff">36</span>:<span style="color:#ae81ff">10</span>)
[GCC <span style="color:#ae81ff">4.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#ae81ff">20150623</span> (Red Hat <span style="color:#ae81ff">4.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>)] on linux2
Type <span style="color:#e6db74">&#34;help&#34;</span>, <span style="color:#e6db74">&#34;copyright&#34;</span>, <span style="color:#e6db74">&#34;credits&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;license&#34;</span> <span style="color:#66d9ef">for</span> more information<span style="color:#f92672">.</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> cinderlib <span style="color:#f92672">as</span> cl
<span style="color:#f92672">&gt;&gt;&gt;</span> lvm <span style="color:#f92672">=</span> cl<span style="color:#f92672">.</span>Backend(target_protocol<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;iscsi&#34;</span>,
                     volume_driver<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder.volume.drivers.lvm.LVMVolumeDriver&#34;</span>,
                     volume_backend_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lvm&#34;</span>,
                     volume_group<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder-volumes&#34;</span>,
                     target_helper<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lioadm&#34;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> v <span style="color:#f92672">=</span> lvm<span style="color:#f92672">.</span>create_volume(<span style="color:#ae81ff">1</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Volume size is </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> v<span style="color:#f92672">.</span>size)
Volume size <span style="color:#f92672">is</span> <span style="color:#ae81ff">1</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> a <span style="color:#f92672">=</span> v<span style="color:#f92672">.</span>attach()
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Path is </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> a<span style="color:#f92672">.</span>path)
Path <span style="color:#f92672">is</span> <span style="color:#f92672">/</span>dev<span style="color:#f92672">/</span>sda
<span style="color:#f92672">&gt;&gt;&gt;</span> s <span style="color:#f92672">=</span> v<span style="color:#f92672">.</span>create_snapshot()
<span style="color:#f92672">&gt;&gt;&gt;</span> s<span style="color:#f92672">.</span>delete()
<span style="color:#f92672">&gt;&gt;&gt;</span> v<span style="color:#f92672">.</span>detach()
<span style="color:#f92672">&gt;&gt;&gt;</span> v<span style="color:#f92672">.</span>delete()</code></pre></div>
<p>If everything goes well you&rsquo;ll be able to perform all of the above operations successfully.  If you are not so fortunate and something goes wrong then these are our troubleshooting recommendations:</p>

<ul>
<li>Double check the configuration.</li>
<li>Carefully read returned error in case there is useful information.</li>
<li>Enable debug logs and see if there is something helpful in them.</li>
<li>Come to the IRC #openstack-cinder channel on Freenode (you can directly ping geguileo)</li>
<li>Send an email to the <a href="http://lists.openstack.org/cgi-bin/mailman/listinfo/openstack-discuss">discuss-openstack mailing list</a> starting the subject with &ldquo;<a href="https://docs.openstack.org/cinderlib">cinderlib</a>&ldquo;</li>
</ul>

<p>To enable debug logs we just need to make a call to <a href="https://docs.openstack.org/cinderlib">cinderlib</a>&rsquo;s <code>setup</code> right after importing the library with parameters <code>disable_logs=False</code> and <code>debug=True</code>.  Here&rsquo;s the same Python code as before, now with debugging logs enabled:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">$</span> python
Python <span style="color:#ae81ff">2.7</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> (default, Apr <span style="color:#ae81ff">11</span> <span style="color:#ae81ff">2018</span>, <span style="color:#ae81ff">07</span>:<span style="color:#ae81ff">36</span>:<span style="color:#ae81ff">10</span>)
[GCC <span style="color:#ae81ff">4.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#ae81ff">20150623</span> (Red Hat <span style="color:#ae81ff">4.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>)] on linux2
Type <span style="color:#e6db74">&#34;help&#34;</span>, <span style="color:#e6db74">&#34;copyright&#34;</span>, <span style="color:#e6db74">&#34;credits&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;license&#34;</span> <span style="color:#66d9ef">for</span> more information<span style="color:#f92672">.</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> cinderlib <span style="color:#f92672">as</span> cl
<span style="color:#f92672">&gt;&gt;&gt;</span> cl<span style="color:#f92672">.</span>setup(disable_logs<span style="color:#f92672">=</span>False, debug<span style="color:#f92672">=</span>True)
<span style="color:#f92672">&gt;&gt;&gt;</span> lvm <span style="color:#f92672">=</span> cl<span style="color:#f92672">.</span>Backend(target_protocol<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;iscsi&#34;</span>,
                     volume_driver<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder.volume.drivers.lvm.LVMVolumeDriver&#34;</span>,
                     volume_backend_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lvm&#34;</span>,
                     volume_group<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder-volumes&#34;</span>,
                     target_helper<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lioadm&#34;</span>)
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.197</span> <span style="color:#ae81ff">4558</span> DEBUG cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>drivers<span style="color:#f92672">.</span>lvm [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Attempting to initialize LVM driver <span style="color:#66d9ef">with</span> the following target_driver: cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>targets<span style="color:#f92672">.</span>lio<span style="color:#f92672">.</span>LioAdm __init__ <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>cinder<span style="color:#f92672">/</span>volume<span style="color:#f92672">/</span>drivers<span style="color:#f92672">/</span>lvm<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">103</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.204</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): cinder<span style="color:#f92672">-</span>rtstool verify execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.365</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;cinder-rtstool verify&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.161</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.366</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.388</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.022</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.390</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">-</span>o name cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.418</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --noheadings -o name cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.028</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.419</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.448</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.029</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.449</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.472</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.023</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.474</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo lvchange <span style="color:#f92672">-</span>a y <span style="color:#f92672">--</span>yes <span style="color:#f92672">-</span>K cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.504</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo lvchange -a y --yes -K cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.030</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.505</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.529</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.024</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.530</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C pvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size,free <span style="color:#f92672">--</span>separator <span style="color:#f92672">|</span> <span style="color:#f92672">--</span>nosuffix <span style="color:#f92672">--</span>ignoreskippedcluster execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.566</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C pvs --noheadings --unit=g -o vg_name,name,size,free --separator | --nosuffix --ignoreskippedcluster&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.035</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.567</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o name,size,free,lv_count,uuid <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.592</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --noheadings --unit=g -o name,size,free,lv_count,uuid --separator : --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.025</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.594</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o name,size,free,lv_count,uuid <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.619</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --noheadings --unit=g -o name,size,free,lv_count,uuid --separator : --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.026</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.620</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.649</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.029</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.650</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o size,data_percent <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix <span style="color:#f92672">/</span>dev<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.679</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C lvs --noheadings --unit=g -o size,data_percent --separator : --nosuffix /dev/cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.029</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.680</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.700</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.020</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.702</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.730</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.029</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.731</span> <span style="color:#ae81ff">4558</span> INFO cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>drivers<span style="color:#f92672">.</span>lvm [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Enabling LVM thin provisioning by default because a thin pool exists<span style="color:#f92672">.</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.732</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.753</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.021</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.754</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.781</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.027</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.782</span> <span style="color:#ae81ff">4558</span> DEBUG cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>drivers<span style="color:#f92672">.</span>lvm [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Updating volume stats _update_volume_stats <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>cinder<span style="color:#f92672">/</span>volume<span style="color:#f92672">/</span>drivers<span style="color:#f92672">/</span>lvm<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">192</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.782</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o name,size,free,lv_count,uuid <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.810</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C vgs --noheadings --unit=g -o name,size,free,lv_count,uuid --separator : --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.028</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.811</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.837</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.026</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.838</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o size,data_percent <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix <span style="color:#f92672">/</span>dev<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.871</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C lvs --noheadings --unit=g -o size,data_percent --separator : --nosuffix /dev/cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.032</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.872</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): sudo env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.898</span> <span style="color:#ae81ff">4558</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;sudo env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.026</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">30.899</span> <span style="color:#ae81ff">4558</span> DEBUG cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>driver [req<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>b68953e<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>a53<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>a8a<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>ac8<span style="color:#f92672">-</span>b4ac49045146 cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Initialized capabilities list: {<span style="color:#e6db74">&#39;driver_version&#39;</span>: <span style="color:#e6db74">&#39;3.0.0&#39;</span>, <span style="color:#e6db74">&#39;sparse_copy_volume&#39;</span>: True, <span style="color:#e6db74">&#39;pools&#39;</span>: [{<span style="color:#e6db74">&#39;pool_name&#39;</span>: <span style="color:#e6db74">&#39;lvm&#39;</span>, <span style="color:#e6db74">&#39;filter_function&#39;</span>: None, <span style="color:#e6db74">&#39;goodness_function&#39;</span>: None, <span style="color:#e6db74">&#39;total_volumes&#39;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;provisioned_capacity_gb&#39;</span>: <span style="color:#ae81ff">0.0</span>, <span style="color:#e6db74">&#39;multiattach&#39;</span>: True, <span style="color:#e6db74">&#39;thin_provisioning_support&#39;</span>: True, <span style="color:#e6db74">&#39;free_capacity_gb&#39;</span>: <span style="color:#ae81ff">20.9</span>, <span style="color:#e6db74">&#39;location_info&#39;</span>: <span style="color:#e6db74">&#39;LVMVolumeDriver:localhost.localdomain:cinder-volumes:thin:0&#39;</span>, <span style="color:#e6db74">&#39;total_capacity_gb&#39;</span>: <span style="color:#ae81ff">20.9</span>, <span style="color:#e6db74">&#39;thick_provisioning_support&#39;</span>: False, <span style="color:#e6db74">&#39;reserved_percentage&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;QoS_support&#39;</span>: False, <span style="color:#e6db74">&#39;max_over_subscription_ratio&#39;</span>: <span style="color:#e6db74">&#39;20.0&#39;</span>, <span style="color:#e6db74">&#39;backend_state&#39;</span>: <span style="color:#e6db74">&#39;up&#39;</span>}], <span style="color:#e6db74">&#39;shared_targets&#39;</span>: False, <span style="color:#e6db74">&#39;vendor_name&#39;</span>: <span style="color:#e6db74">&#39;Open Source&#39;</span>, <span style="color:#e6db74">&#39;volume_backend_name&#39;</span>: <span style="color:#e6db74">&#39;lvm&#39;</span>, <span style="color:#e6db74">&#39;properties&#39;</span>: {<span style="color:#e6db74">&#39;replication_enabled&#39;</span>: {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;boolean&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Enables replication.&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;Replication&#39;</span>}, <span style="color:#e6db74">&#39;qos&#39;</span>: {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;boolean&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Enables QoS.&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;QoS&#39;</span>}, <span style="color:#e6db74">&#39;compression&#39;</span>: {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;boolean&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Enables compression.&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;Compression&#39;</span>}, <span style="color:#e6db74">&#39;thin_provisioning&#39;</span>: {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;boolean&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Sets thin provisioning.&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;Thin Provisioning&#39;</span>}}, <span style="color:#e6db74">&#39;storage_protocol&#39;</span>: <span style="color:#e6db74">&#39;iSCSI&#39;</span>}<span style="color:#f92672">.</span> init_capabilities <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>cinder<span style="color:#f92672">/</span>volume<span style="color:#f92672">/</span>driver<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">771</span>
<span style="color:#f92672">&gt;&gt;&gt;</span></code></pre></div>
<h4 id="cinderlib-on-a-container">Cinderlib on a container</h4>

<p>The main differences between running <a href="https://docs.openstack.org/cinderlib">cinderlib</a> in a container instead of directly on the host are:</p>

<ul>
<li><a href="https://docs.openstack.org/cinder">Cinder</a> is already installed</li>
<li><a href="https://docs.openstack.org/cinderlib">cinderlib</a> is already installed</li>
<li>Some driver dependencies are already installed, such as Kaminaro&rsquo;s, Pure&rsquo;s, RBD&rsquo;s, IBM&rsquo;s XIV&hellip;</li>
<li>We need Docker installed and running</li>
<li>We have to mount a good number of directories from the host for the container to work.</li>
</ul>

<p>We also recommend running the container inside a CentOS VM instead of directly on our host.</p>

<p>First we&rsquo;ll install Docker:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum install -y docker
$ sudo systemctl start docker</code></pre></div>
<p>Now we need to install required storage transport tools on the host.  For example, if our backend uses iSCSI as the transport protocol we would do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo yum install -y iscsi-initiator-utils
$ sudo systemctl start iscsid</code></pre></div>
<p>On an Ember-CSI container we&rsquo;ll be using an interactive terminal to run Python&rsquo;s interactive interpreter to manually verify that the code generated using <code>cinder_cfg_to_python.py</code> works and we can create a volume, attach it, create and delete a snapshot, detach the volume, and finally delete it.</p>

<p>Here is an example of how running the container for an iSCSI backend looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo docker run -it --name<span style="color:#f92672">=</span>cinderlib --privileged --net<span style="color:#f92672">=</span>host <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -v /etc/iscsi:/etc/iscsi <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -v /dev:/dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -v /etc/lvm:/etc/lvm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -v /var/lock/lvm:/var/lock/lvm <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -v /lib/modules:/lib/modules:ro <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -v /run/udev:/run/udev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -v /var/lib/iscsi:/var/lib/iscsi <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -v /etc/localtime:/etc/localtime:ro <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; embercsi/ember-csi:master <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; /bin/bash
Unable to find image <span style="color:#e6db74">&#39;embercsi/ember-csi:master&#39;</span> locally
Trying to pull repository docker.io/embercsi/ember-csi ...
latest: Pulling from docker.io/embercsi/ember-csi
a02a4930cb5d: Pull complete
c3f23e23c56d: Pull complete
1383c88742c3: Pull complete
7db1aa6bfbef: Pull complete
687908c02c8e: Pull complete
7933b36934cc: Pull complete
e129bae24b5f: Pull complete
Digest: sha256:bd1dcf87870eea5d3ea89945c41b37cd5b5f9eef226e026aab18db4d5598bc6a
Status: Downloaded newer image <span style="color:#66d9ef">for</span> docker.io/embercsi/ember-csi:master
<span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span>#</code></pre></div>
<p>Now we can check that <a href="https://docs.openstack.org/cinder">Cinder</a> and <a href="https://docs.openstack.org/cinderlib">cinderlib</a> are present in the container by listing available drivers:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span># python -c <span style="color:#e6db74">&#39;import cinderlib as cl; print(&#34;\n&#34;.join(cl.list_supported_drivers().keys()))&#39;</span></code></pre></div>
<p>Before we can see if the driver works as expected, we have make sure that the container has the external dependencies required by our storage backend driver.  For example Ceph/RBD requires the package <code>ceph-common</code>, 3PAR requires the <code>python-3parclient</code> PyPi package, Pure <code>purestorage</code>, IBM XIV <code>pyxcli</code> and <code>pyOpenSSL</code>.  The <a href="https://docs.openstack.org/cinder">Cinder</a> project keeps a <a href="https://github.com/openstack/cinder/blob/master/driver-requirements.txt">list of PyPi package dependencies by driver</a> and some drivers also describe these dependencies in their <a href="https://docs.openstack.org/cinder/rocky/configuration/block-storage/volume-drivers.html">OpenStack documentation</a>.  The Ember-CSI container already has some dependencies included, so you may not need to install anything.</p>

<p>For example if we were using HPE 3PAR we would do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@localhost /<span style="color:#f92672">]</span># sudo pip install <span style="color:#e6db74">&#39;python-3parclient&gt;=4.0,&lt;5.0&#39;</span></code></pre></div>
<p><strong>Note:</strong> It is important to take note of the packages and external files we are adding in order to run cinderlib with our backend, as we&rsquo;ll need it for later.</p>

<p>Now we are finally ready to manually test the driver compatibility, so let&rsquo;s have a look at how it would look like for the LVM backend and assume this will not be the backend used, as we would need to actually set the LVM VG before hand, change the hosts <code>/etc/lvm/lvm.conf</code> and mount additional directories:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[root<span style="color:#a6e22e">@localhost</span> <span style="color:#f92672">/</span>]<span style="color:#75715e"># python</span>
Python <span style="color:#ae81ff">2.7</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> (default, Oct <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">2018</span>, <span style="color:#ae81ff">23</span>:<span style="color:#ae81ff">45</span>:<span style="color:#ae81ff">53</span>)
[GCC <span style="color:#ae81ff">4.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#ae81ff">20150623</span> (Red Hat <span style="color:#ae81ff">4.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">-</span><span style="color:#ae81ff">36</span>)] on linux2
Type <span style="color:#e6db74">&#34;help&#34;</span>, <span style="color:#e6db74">&#34;copyright&#34;</span>, <span style="color:#e6db74">&#34;credits&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;license&#34;</span> <span style="color:#66d9ef">for</span> more information<span style="color:#f92672">.</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> cinderlib <span style="color:#f92672">as</span> cl
<span style="color:#f92672">&gt;&gt;&gt;</span> lvm <span style="color:#f92672">=</span> cl<span style="color:#f92672">.</span>Backend(target_protocol<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;iscsi&#34;</span>,
                     volume_driver<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder.volume.drivers.lvm.LVMVolumeDriver&#34;</span>,
                     volume_backend_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lvm&#34;</span>,
                     volume_group<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder-volumes&#34;</span>,
                     target_helper<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lioadm&#34;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> v <span style="color:#f92672">=</span> lvm<span style="color:#f92672">.</span>create_volume(<span style="color:#ae81ff">1</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Volume size is </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> v<span style="color:#f92672">.</span>size)
Volume size <span style="color:#f92672">is</span> <span style="color:#ae81ff">1</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> a <span style="color:#f92672">=</span> v<span style="color:#f92672">.</span>attach()
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Path is </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> a<span style="color:#f92672">.</span>path)
Path <span style="color:#f92672">is</span> <span style="color:#f92672">/</span>dev<span style="color:#f92672">/</span>sda
<span style="color:#f92672">&gt;&gt;&gt;</span> s <span style="color:#f92672">=</span> v<span style="color:#f92672">.</span>create_snapshot()
<span style="color:#f92672">&gt;&gt;&gt;</span> s<span style="color:#f92672">.</span>delete()
<span style="color:#f92672">&gt;&gt;&gt;</span> v<span style="color:#f92672">.</span>detach()
<span style="color:#f92672">&gt;&gt;&gt;</span> v<span style="color:#f92672">.</span>delete()</code></pre></div>
<p>If everything goes well you&rsquo;ll be able to perform all of the above operations successfully.  If you are not so fortunate and something goes wrong then these are our recommendations:</p>

<ul>
<li>Double check the configuration.</li>
<li>Carefully read returned error in case there is useful information.</li>
<li>Enable debug logs and see if there is something helpful in them.</li>
<li>Try to run these same tests on the host instead of in a container.</li>
<li>Come to the IRC #openstack-cinder channel on Freenode (you can directly ping geguileo)</li>
<li>Send an email to the <a href="http://lists.openstack.org/cgi-bin/mailman/listinfo/openstack-discuss">discuss-openstack mailing list</a> starting the subject with &ldquo;<a href="https://docs.openstack.org/cinderlib">cinderlib</a>&ldquo;</li>
</ul>

<p>To enable debug logs we just need to make a call to <a href="https://docs.openstack.org/cinderlib">cinderlib</a>&rsquo;s <code>setup</code> right after importing the library:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[root<span style="color:#a6e22e">@localhost</span> <span style="color:#f92672">/</span>]<span style="color:#75715e"># python</span>
Python <span style="color:#ae81ff">2.7</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> (default, Oct <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">2018</span>, <span style="color:#ae81ff">23</span>:<span style="color:#ae81ff">45</span>:<span style="color:#ae81ff">53</span>)
[GCC <span style="color:#ae81ff">4.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#ae81ff">20150623</span> (Red Hat <span style="color:#ae81ff">4.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">-</span><span style="color:#ae81ff">36</span>)] on linux2
Type <span style="color:#e6db74">&#34;help&#34;</span>, <span style="color:#e6db74">&#34;copyright&#34;</span>, <span style="color:#e6db74">&#34;credits&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;license&#34;</span> <span style="color:#66d9ef">for</span> more information<span style="color:#f92672">.</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> cinderlib <span style="color:#f92672">as</span> cl
<span style="color:#f92672">&gt;&gt;&gt;</span> cl<span style="color:#f92672">.</span>setup(disable_logs<span style="color:#f92672">=</span>False, debug<span style="color:#f92672">=</span>True)
<span style="color:#f92672">&gt;&gt;&gt;</span> lvm <span style="color:#f92672">=</span> cl<span style="color:#f92672">.</span>Backend(target_protocol<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;iscsi&#34;</span>,
<span style="color:#f92672">...</span>                  volume_driver<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder.volume.drivers.lvm.LVMVolumeDriver&#34;</span>,
<span style="color:#f92672">...</span>                  volume_backend_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lvm&#34;</span>,
<span style="color:#f92672">...</span>                  volume_group<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cinder-volumes&#34;</span>,
<span style="color:#f92672">...</span>                  target_helper<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lioadm&#34;</span>)
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">28.609</span> <span style="color:#ae81ff">204</span> DEBUG cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>drivers<span style="color:#f92672">.</span>lvm [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Attempting to initialize LVM driver <span style="color:#66d9ef">with</span> the following target_driver: cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>targets<span style="color:#f92672">.</span>lio<span style="color:#f92672">.</span>LioAdm __init__ <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>cinder<span style="color:#f92672">/</span>volume<span style="color:#f92672">/</span>drivers<span style="color:#f92672">/</span>lvm<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">103</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">28.615</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): cinder<span style="color:#f92672">-</span>rtstool verify execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">29.268</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;cinder-rtstool verify&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.654</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">29.270</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">29.758</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.488</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">29.759</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">-</span>o name cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">30.269</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --noheadings -o name cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.510</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">30.270</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">30.764</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.494</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">30.765</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">31.264</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.499</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">31.265</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): lvchange <span style="color:#f92672">-</span>a y <span style="color:#f92672">--</span>yes <span style="color:#f92672">-</span>K cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">31.766</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;lvchange -a y --yes -K cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.501</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">31.767</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">32.262</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.495</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">32.263</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C pvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size,free <span style="color:#f92672">--</span>separator <span style="color:#f92672">|</span> <span style="color:#f92672">--</span>nosuffix <span style="color:#f92672">--</span>ignoreskippedcluster execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">32.777</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C pvs --noheadings --unit=g -o vg_name,name,size,free --separator | --nosuffix --ignoreskippedcluster&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.514</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">32.778</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o name,size,free,lv_count,uuid <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">33.283</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --noheadings --unit=g -o name,size,free,lv_count,uuid --separator : --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.505</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">33.284</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o name,size,free,lv_count,uuid <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">33.792</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --noheadings --unit=g -o name,size,free,lv_count,uuid --separator : --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.508</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">33.793</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">34.303</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.510</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">34.304</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o size,data_percent <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix <span style="color:#f92672">/</span>dev<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">34.809</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C lvs --noheadings --unit=g -o size,data_percent --separator : --nosuffix /dev/cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.505</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">34.810</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">35.308</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.498</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">35.308</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">35.826</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.517</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">35.827</span> <span style="color:#ae81ff">204</span> INFO cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>drivers<span style="color:#f92672">.</span>lvm [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Enabling LVM thin provisioning by default because a thin pool exists<span style="color:#f92672">.</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">35.828</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>version execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">36.343</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --version&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.515</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">36.344</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">36.850</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.506</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">36.852</span> <span style="color:#ae81ff">204</span> DEBUG cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>drivers<span style="color:#f92672">.</span>lvm [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Updating volume stats _update_volume_stats <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>cinder<span style="color:#f92672">/</span>volume<span style="color:#f92672">/</span>drivers<span style="color:#f92672">/</span>lvm<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">192</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">36.852</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C vgs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o name,size,free,lv_count,uuid <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">37.359</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C vgs --noheadings --unit=g -o name,size,free,lv_count,uuid --separator : --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.507</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">37.360</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">37.870</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.511</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">37.872</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o size,data_percent <span style="color:#f92672">--</span>separator : <span style="color:#f92672">--</span>nosuffix <span style="color:#f92672">/</span>dev<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">/</span>cinder<span style="color:#f92672">-</span>volumes<span style="color:#f92672">-</span>pool execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">38.385</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C lvs --noheadings --unit=g -o size,data_percent --separator : --nosuffix /dev/cinder-volumes/cinder-volumes-pool&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.513</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">38.387</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Running cmd (subprocess): env LC_ALL<span style="color:#f92672">=</span>C lvs <span style="color:#f92672">--</span>noheadings <span style="color:#f92672">--</span>unit<span style="color:#f92672">=</span>g <span style="color:#f92672">-</span>o vg_name,name,size <span style="color:#f92672">--</span>nosuffix cinder<span style="color:#f92672">-</span>volumes execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">372</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">38.913</span> <span style="color:#ae81ff">204</span> DEBUG oslo_concurrency<span style="color:#f92672">.</span>processutils [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] CMD <span style="color:#e6db74">&#34;env LC_ALL=C lvs --noheadings --unit=g -o vg_name,name,size --nosuffix cinder-volumes&#34;</span> returned: <span style="color:#ae81ff">0</span> <span style="color:#f92672">in</span> <span style="color:#ae81ff">0.526</span>s execute <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>oslo_concurrency<span style="color:#f92672">/</span>processutils<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">409</span>
<span style="color:#ae81ff">2019</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">38.914</span> <span style="color:#ae81ff">204</span> DEBUG cinder<span style="color:#f92672">.</span>volume<span style="color:#f92672">.</span>driver [req<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>d9eed8e<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>cf4<span style="color:#f92672">-</span><span style="color:#ae81ff">4e31</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8919</span><span style="color:#f92672">-</span><span style="color:#ae81ff">131</span>a3394099c cinderlib cinderlib <span style="color:#f92672">-</span> <span style="color:#f92672">-</span> <span style="color:#f92672">-</span>] Initialized capabilities list: {<span style="color:#e6db74">&#39;driver_version&#39;</span>: <span style="color:#e6db74">&#39;3.0.0&#39;</span>, <span style="color:#e6db74">&#39;sparse_copy_volume&#39;</span>: True, <span style="color:#e6db74">&#39;pools&#39;</span>: [{<span style="color:#e6db74">&#39;pool_name&#39;</span>: <span style="color:#e6db74">&#39;lvm&#39;</span>, <span style="color:#e6db74">&#39;filter_function&#39;</span>: None, <span style="color:#e6db74">&#39;goodness_function&#39;</span>: None, <span style="color:#e6db74">&#39;total_volumes&#39;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;provisioned_capacity_gb&#39;</span>: <span style="color:#ae81ff">0.0</span>, <span style="color:#e6db74">&#39;multiattach&#39;</span>: True, <span style="color:#e6db74">&#39;thin_provisioning_support&#39;</span>: True, <span style="color:#e6db74">&#39;free_capacity_gb&#39;</span>: <span style="color:#ae81ff">20.9</span>, <span style="color:#e6db74">&#39;location_info&#39;</span>: <span style="color:#e6db74">&#39;LVMVolumeDriver:localhost.localdomain:cinder-volumes:thin:0&#39;</span>, <span style="color:#e6db74">&#39;total_capacity_gb&#39;</span>: <span style="color:#ae81ff">20.9</span>, <span style="color:#e6db74">&#39;thick_provisioning_support&#39;</span>: False, <span style="color:#e6db74">&#39;reserved_percentage&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;QoS_support&#39;</span>: False, <span style="color:#e6db74">&#39;max_over_subscription_ratio&#39;</span>: <span style="color:#e6db74">&#39;20.0&#39;</span>, <span style="color:#e6db74">&#39;backend_state&#39;</span>: <span style="color:#e6db74">&#39;up&#39;</span>}], <span style="color:#e6db74">&#39;shared_targets&#39;</span>: False, <span style="color:#e6db74">&#39;vendor_name&#39;</span>: <span style="color:#e6db74">&#39;Open Source&#39;</span>, <span style="color:#e6db74">&#39;volume_backend_name&#39;</span>: <span style="color:#e6db74">&#39;lvm&#39;</span>, <span style="color:#e6db74">&#39;properties&#39;</span>: {<span style="color:#e6db74">&#39;replication_enabled&#39;</span>: {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;boolean&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Enables replication.&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;Replication&#39;</span>}, <span style="color:#e6db74">&#39;qos&#39;</span>: {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;boolean&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Enables QoS.&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;QoS&#39;</span>}, <span style="color:#e6db74">&#39;compression&#39;</span>: {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;boolean&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Enables compression.&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;Compression&#39;</span>}, <span style="color:#e6db74">&#39;thin_provisioning&#39;</span>: {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;boolean&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Sets thin provisioning.&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;Thin Provisioning&#39;</span>}}, <span style="color:#e6db74">&#39;storage_protocol&#39;</span>: <span style="color:#e6db74">&#39;iSCSI&#39;</span>}<span style="color:#f92672">.</span> init_capabilities <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>python2<span style="color:#f92672">.</span><span style="color:#ae81ff">7</span><span style="color:#f92672">/</span>site<span style="color:#f92672">-</span>packages<span style="color:#f92672">/</span>cinder<span style="color:#f92672">/</span>volume<span style="color:#f92672">/</span>driver<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">771</span>
<span style="color:#f92672">&gt;&gt;&gt;</span></code></pre></div>
<h3 id="getting-the-ember-csi-demo">Getting the Ember-CSI demo</h3>

<p>Congratulations!  If you have reached this point it means that your backend is compatible with <a href="https://docs.openstack.org/cinderlib">cinderlib</a>, and therefore with Ember-CSI as well.  The rest of the process should not be a problem.</p>

<p>For this part of the process it&rsquo;s easier to run it on our own host, since you probably already have all dependencies installed and we&rsquo;ll be creating 3 VMs anyway.  You can still run it inside a VM, as long as you have properly enabled nested virtualization.</p>

<p>To run the example we&rsquo;ll need <code>git</code>, <code>ansible</code>, <code>qemu-kvm</code>, <code>libvirt</code>, <code>vagrant</code> and <code>vagrant-libvirt</code>.  Which you can get installed on Fedora with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo dnf -y install git qemu-kvm libvirt vagrant vagrant-libvirt ansible
$ sudo systemctl start libvirtd</code></pre></div>
<p>For CentOS it is a little bit more complicated, but still reasonable:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo dnf -y install epel-release
$ sudo yum -y install qemu-kvm libvirt ansible gcc libvirt-devel
$ sudo yum -y install https://releases.hashicorp.com/vagrant/2.2.4/vagrant_2.2.4_x86_64.rpm
$ sudo vagrant plugin install vagrant-libvirt
$ sudo systemctl start libvirtd</code></pre></div>
<p>And now that we have the example requirements we proceed to download the Ember-CSI repository to have the example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ git clone git@github.com:embercsi/ember-csi.git
$ cd ember-csi/examples/k8s_v1.13-CSI_v1.0</code></pre></div>
<h3 id="setting-ember-csi-s-configuration">Setting Ember-CSI&rsquo;s configuration</h3>

<p>The configuration required by Ember-CSI is the same as the one we used for <a href="https://docs.openstack.org/cinderlib">cinderlib</a>, just on a different format.  For <a href="https://docs.openstack.org/cinderlib">cinderlib</a> we used Python types, and for Ember-CSI we must use a JSON string.  The fastest way to get the right string is to serialize the configuration that is currently being used in the <a href="https://docs.openstack.org/cinderlib">cinderlib</a> <code>Backend</code> instance in our Python interpreter.</p>

<p>It would look like this in our LVM example where the backend is called <code>lvm</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> json
<span style="color:#f92672">&gt;&gt;&gt;</span> json<span style="color:#f92672">.</span>dumps(lvm<span style="color:#f92672">.</span>_driver_cfg, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;:&#39;</span>))
<span style="color:#e6db74">&#39;{&#34;target_protocol&#34;:&#34;iscsi&#34;,&#34;volume_driver&#34;:&#34;cinder.volume.drivers.lvm.LVMVolumeDriver&#34;,&#34;volume_backend_name&#34;:&#34;lvm&#34;,&#34;volume_group&#34;:&#34;cinder-volumes&#34;,&#34;target_helper&#34;:&#34;lioadm&#34;}&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span></code></pre></div>
<p>Now we copy that string, since it&rsquo;ll be the one we use for Ember-CSI, because even though Ember-CSI supports a simpler configuration and we could replace <code>&quot;volume_driver&quot;:&quot;cinder.volume.drivers.lvm.LVMVolumeDriver&quot;</code> with <code>&quot;driver&quot;:&quot;LVMVolume&quot;</code>, and <code>&quot;volume_backend_name&quot;:&quot;lvm&quot;</code> with <code>&quot;name&quot;:&quot;lvm&quot;</code> leaving us with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> <span style="color:#e6db74">`&#39;{&#34;target_protocol&#34;:&#34;iscsi&#34;,&#34;driver&#34;:&#34;LVMVolume&#34;,&#34;name&#34;:&#34;lvm&#34;,&#34;volume_group&#34;:&#34;cinder-volumes&#34;,&#34;target_helper&#34;:&#34;lioadm&#34;}&#39;`</span></code></pre></div>
<p>In our case there is no need to do this, since Ember-CSI also accepts the exact same configuration as <a href="https://docs.openstack.org/cinderlib">cinderlib</a>, and it is more convenient for us that we have a <a href="https://docs.openstack.org/cinderlib">cinderlib</a> configuration already as a JSON string to use what we have.</p>

<p>With that configuration we replace the <code>ember_lvm_config</code> section in the <code>global_vars.yml</code> file.</p>

<h3 id="ember-csi-image">Ember-CSI image</h3>

<p>Now that we have been able to use <a href="https://docs.openstack.org/cinderlib">cinderlib</a> to access our storage backend we know that we can use it in Ember-CSI, and we have all the information we need to use our storage in Kubernetes using Ember-CSI, as we have:</p>

<ul>
<li>Driver configuration</li>
<li>List of external dependencies we had to install to make <a href="https://docs.openstack.org/cinderlib">cinderlib</a> work</li>
</ul>

<p>But we need to determine if the standard <a href="https://hub.docker.com/r/embercsi/ember-csi">Ember-CSI image</a> supports our storage backend off the bat, or if we need to make some adjustments to it.</p>

<p>As we mentioned before Ember-CSI includes dependencies for some drivers and there are also many drivers that don&rsquo;t have external dependencies, so how can we tell if we can use the image as it is?</p>

<p>As one would expect, you can use the image as it is if you didn&rsquo;t have to install any dependencies, and if you had to install some packages you just have to check if they are already available in the image looking at the <a href="https://github.com/embercsi/ember-csi/blob/master/Dockerfile#L34-L37">Dockerfile</a> or manually exploring the image itself (<code>docker run -it --rm embercsi/ember-csi:master /bin/bash</code>).</p>

<p>If you have been fortunate enough to have the dependencies, you can skip to the <a href="#testing-in-a-container">next section</a>, if you haven&rsquo;t you&rsquo;ll have to create your custom image to include those dependencies, but don&rsquo;t worry, it&rsquo;s pretty easy.</p>

<h4 id="building-a-custom-image">Building a custom image</h4>

<p>To build a custom image we will create a <code>Dockerfile.custom</code> file, base our image on the <code>embercsi/ember-csi:master</code> image, and add the commands we run before to install our dependencies.</p>

<p>Here&rsquo;s how it would look like for the HPE 3PAR driver that only needs to install the <code>python-3parclient</code> Python library:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cat Dockerfile.custom
FROM embercsi/ember-csi:master
RUN pip install <span style="color:#e6db74">&#39;python-3parclient&gt;=4.0,&lt;5.0&#39;</span></code></pre></div>
<p>Some backends also need additional configuration files, for example Ceph, that requires credential files.  In those cases we can either include those files in our custom image adding the appropriate <code>COPY</code> command to the Dockerfile, or replace the <code>roles/master/files/system-files.tar</code> file (the contents must be from the root directory).  We recommend using recommend including the files in the custom image as it is simpler. You don&rsquo;t have to worry about real deployments, because in those cases we would use secrets and the <code>X_CSI_SYSTEM_FILES</code> Ember-CSI parameter.</p>

<p>And now we build the image and tag it as <code>ember-csi:custom</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker build -t ember-csi:custom -f Dockerfile.custom .
Sending build context to Docker daemon <span style="color:#ae81ff">1</span>.382 MB
Step <span style="color:#ae81ff">1</span>/2 : FROM embercsi/ember-csi:master
 ---&gt; 308aca736db3
Step <span style="color:#ae81ff">2</span>/2 : RUN pip install <span style="color:#e6db74">&#39;python-3parclient&gt;=4.0,&lt;5.0&#39;</span>
 ---&gt; Running in fe53bc3f2ba6
Collecting python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0
  Downloading https://files.pythonhosted.org/packages/2e/53/7de45eb87bdb6599f32d78cac5b50cb3493d35fef6d5082749ac412bc9f5/python-3parclient-4.2.9.tar.gz <span style="color:#f92672">(</span>118kB<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: paramiko in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: eventlet in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: requests in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: cryptography&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.5 in /usr/lib64/python2.7/site-packages <span style="color:#f92672">(</span>from paramiko-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: pynacl&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.0.1 in /usr/lib64/python2.7/site-packages <span style="color:#f92672">(</span>from paramiko-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: pyasn1&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.1.7 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from paramiko-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: bcrypt&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>.1.3 in /usr/lib64/python2.7/site-packages <span style="color:#f92672">(</span>from paramiko-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: monotonic&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.4 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from eventlet-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: six&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.10.0 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from eventlet-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: dnspython&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.15.0 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from eventlet-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: greenlet&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.3 in /usr/lib64/python2.7/site-packages <span style="color:#f92672">(</span>from eventlet-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: enum34; python_version &lt; <span style="color:#e6db74">&#34;3.4&#34;</span> in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from eventlet-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: urllib3&lt;<span style="color:#ae81ff">1</span>.25,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.21.1 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from requests-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: chardet&lt;<span style="color:#ae81ff">3</span>.1.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>.0.2 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from requests-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: idna&lt;<span style="color:#ae81ff">2</span>.9,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>.5 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from requests-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: certifi&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">2017</span>.4.17 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from requests-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: asn1crypto&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.21.0 in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from cryptography&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.5-&gt;paramiko-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: cffi!<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.11.3,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.8 in /usr/lib64/python2.7/site-packages <span style="color:#f92672">(</span>from cryptography&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.5-&gt;paramiko-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: ipaddress; python_version &lt; <span style="color:#e6db74">&#34;3&#34;</span> in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from cryptography&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.5-&gt;paramiko-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Requirement already satisfied <span style="color:#f92672">(</span>use --upgrade to upgrade<span style="color:#f92672">)</span>: pycparser in /usr/lib/python2.7/site-packages <span style="color:#f92672">(</span>from cffi!<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.11.3,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.8-&gt;cryptography&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.5-&gt;paramiko-&gt;python-3parclient&lt;<span style="color:#ae81ff">5</span>.0,&gt;<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0<span style="color:#f92672">)</span>
Installing collected packages: python-3parclient
  Running setup.py install <span style="color:#66d9ef">for</span> python-3parclient: started
    Running setup.py install <span style="color:#66d9ef">for</span> python-3parclient: finished with status <span style="color:#e6db74">&#39;done&#39;</span>
Successfully installed python-3parclient-4.2.9
You are using pip version <span style="color:#ae81ff">8</span>.1.2, however version <span style="color:#ae81ff">19</span>.0.3 is available.
You should consider upgrading via the <span style="color:#e6db74">&#39;pip install --upgrade pip&#39;</span> command.
 ---&gt; 0859f46d0c44
Removing intermediate container fe53bc3f2ba6
Successfully built 0859f46d0c44</code></pre></div>
<p>With this we now have a custom Ember-CSI image that includes the necessary dependencies for our storage backend.</p>

<h4 id="testing-the-image">Testing the image</h4>

<p>This step is not strictly necessary, but it is a nice one for those who want to do a sanity check on the image they&rsquo;ve just built.</p>

<p>To check our image we&rsquo;ll run the Ember-CSI container locally and use the <a href="https://github.com/rexray/gocsi/tree/master/csc">Container Storage Client</a>, csc for shorts, to request a couple of basic operations on Ember-CSI.</p>

<p>First we run the Ember-CSI container on port 50051 using the configuration JSON string we generated earlier (we assume it&rsquo;s stored in <code>CINDERLIB_CONFIG</code>) and confirm that the service is able to start and initialize the driver:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run --name<span style="color:#f92672">=</span>ember -d <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -p <span style="color:#ae81ff">50051</span>:50051 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -e CSI_MODE<span style="color:#f92672">=</span>controller  <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -e X_CSI_SPEC_VERSION<span style="color:#f92672">=</span>v1 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -e X_CSI_PERSISTENCE_CONFIG<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{&#34;storage&#34;:&#34;memory&#34;}&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; -e X_CSI_BACKEND_CONFIG<span style="color:#f92672">=</span>$CINDERLIB_CONFIG <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>&gt; ember-csi:custom
74e5eacc721cdb381215f4f5a7ce62746c6cc818a0da21695e49e1f78d5e613a

$ docker logs ember
<span style="color:#ae81ff">2019</span>-04-05 <span style="color:#ae81ff">13</span>:44:20 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Ember CSI v0.0.2 with <span style="color:#ae81ff">30</span> workers <span style="color:#f92672">(</span>CSI spec: v1.0.0, cinderlib: v0.3.10.dev10, cinder: v13.1.0.dev926<span style="color:#f92672">)</span>
<span style="color:#ae81ff">2019</span>-04-05 <span style="color:#ae81ff">13</span>:44:20 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Persistence module: MemoryPersistence
<span style="color:#ae81ff">2019</span>-04-05 <span style="color:#ae81ff">13</span>:44:20 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Running as controller with backend KaminarioISCSIDriver v1.4
<span style="color:#ae81ff">2019</span>-04-05 <span style="color:#ae81ff">13</span>:44:20 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Plugin name: ember-csi.io
<span style="color:#ae81ff">2019</span>-04-05 <span style="color:#ae81ff">13</span>:44:20 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Debugging feature is ENABLED with ember_csi.rpdb and OFF. Toggle it with SIGUSR1.
<span style="color:#ae81ff">2019</span>-04-05 <span style="color:#ae81ff">13</span>:44:20 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Supported filesystems: minix, cramfs, btrfs, ext4, ext3, xfs, ext2
<span style="color:#ae81ff">2019</span>-04-05 <span style="color:#ae81ff">13</span>:44:20 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Now serving on <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:50051...</code></pre></div>
<p>Now we will issue 3 simple commands:</p>

<ul>
<li>Get the plugin info: To confirm CSC is communicating with the Ember-CSI plugin via gRPC.</li>
<li>Create a volume: To confirm that Ember-CSI can communicate with out storage backend.</li>
<li>Delete the volume: To clean up</li>
</ul>

<p>With this basic sanity check we&rsquo;ll be able to confirm that Ember-CSI not only starts successfully, but it is also able to connect to our storage backend.</p>

<p>The UUID value we assign to <code>vol_id</code> for the delete operation is the first value returned by the volume creation operation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run --network<span style="color:#f92672">=</span>host --rm -it embercsi/csc identity plugin-info -e tcp://127.0.0.1:50051
<span style="color:#e6db74">&#34;ember-csi.io&#34;</span>  <span style="color:#e6db74">&#34;0.0.2&#34;</span> <span style="color:#e6db74">&#34;cinder-driver&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;KaminarioISCSIDriver&#34;</span>  <span style="color:#e6db74">&#34;cinder-driver-supported&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;True&#34;</span>        <span style="color:#e6db74">&#34;cinder-driver-version&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.4&#34;</span>   <span style="color:#e6db74">&#34;cinder-version&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;13.1.0.dev926&#34;</span>        <span style="color:#e6db74">&#34;cinderlib-version&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0.3.10.dev10&#34;</span>     <span style="color:#e6db74">&#34;mode&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;controller&#34;</span>     <span style="color:#e6db74">&#34;persistence&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MemoryPersistence&#34;</span>

$ docker run --network<span style="color:#f92672">=</span>host --rm -it embercsi/csc controller create-volume --cap SINGLE_NODE_WRITER,block --req-bytes <span style="color:#ae81ff">2147483648</span> disk -e tcp://127.0.0.1:50051
<span style="color:#e6db74">&#34;d2382978-fbdc-4abd-8049-a7a5bbb8c0d5&#34;</span>  <span style="color:#ae81ff">2147483648</span>

$ vol_id<span style="color:#f92672">=</span>d2382978-fbdc-4abd-8049-a7a5bbb8c0d5

$ docker run --network<span style="color:#f92672">=</span>host --rm -it embercsi/csc controller delete-volume $vol_id -e tcp://127.0.0.1:50051
d2382978-fbdc-4abd-8049-a7a5bbb8c0d5</code></pre></div>
<p>Now we can stop the <code>ember</code> container:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker rm -f ember</code></pre></div>
<h4 id="making-the-image-available">Making the image available</h4>

<p>Now that we have built and tested the image, we have to make it available for the VMs that will be running the Kubernetes cluster.  We can do this 2 ways:</p>

<ul>
<li>Publishing it to a public registry</li>
<li>Publishing to our own local registry</li>
</ul>

<p>Both ways are valid and it will only depend on your own preferences which one you want to use, unless you have added configuration files that have sensitive data, in which case you must use the local registry in order to keep this information confidential.</p>

<p>To publish to a public registry we just retag the image and push it.  For example if our Docker Hub user was called <code>cooluser</code> we would do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker tag ember-csi:custom cooluser/ember-csi:custom
$ docker push cooluser/ember-csi:custom</code></pre></div>
<p>And if we want to publish it to a local registry we can use the <code>registry</code> container and our local IP, for example if it were <code>192.168.1.7</code> it would be like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker run -d -p <span style="color:#ae81ff">5000</span>:5000 --name registry registry:2
$ docker tag ember-csi:custom <span style="color:#ae81ff">192</span>.168.1.7:5000/ember-csi:custom
$ docker push <span style="color:#ae81ff">192</span>.168.1.7:5000/ember-csi:custom</code></pre></div>
<p>With this, our custom image can now be consumed by the example.</p>

<h4 id="using-the-custom-image">Using the custom image</h4>

<p>We must make some changes to the example in order to uses this custom image on the deployment.</p>

<p>Edit file <code>global_vars.yml</code> and replace <code>ember_image</code> with our custom image.</p>

<p>From:</p>

<pre><code>ember_image: embercsi/ember-csi:master
</code></pre>

<p>To:</p>

<pre><code>ember_image: cooluser/ember-csi:custom
</code></pre>

<p>And if we are using a local registry we must also replace <code>ember_insecure_registry</code>.  In the example we mentioned earlier this would result in the following:</p>

<pre><code>ember_image: 192.168.1.7:5000/ember-csi:custom
ember_insecure_registry: 192.168.1.7:5000
</code></pre>

<p>And now our own image will be used when we run the example and we are ready to deploy a full Kubernetes cluster that uses our storage backend.</p>

<h3 id="deploying-kubernetes">Deploying Kubernetes</h3>

<p>At this point we have prepared our system to run the Kubernetes + Ember-CSI example, we have verified that our storage works with cinderlib, set our backend configuration for the example, and we know which Ember-CSI container image we must use and have set it in the example, so all that&rsquo;s left to do is actually run the example and confirm that everything works fine in a real Kubernetes deployment.</p>

<p>To run the example we have a simple bash script called <code>up.sh</code> in the <code>examples/k8s_v1.13-CSI_v1.0</code> directory where we had modified the <code>global_vars.yml</code> file.  This script creates the 3 VMs using vagrant, and then provisions them using Ansible to deploy Kubernetes 1.13, then creates an LVM VG, then deploys 2 Ember-CSI plugins, one using the LVM VG, and another with a toy Ceph cluster, finally it will create the storage classes for the volumes and snapshots.</p>

<p>It will take a while to run, so must be patient:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ./up.sh
Bringing machine <span style="color:#e6db74">&#39;master&#39;</span> up with <span style="color:#e6db74">&#39;libvirt&#39;</span> provider...
Bringing machine <span style="color:#e6db74">&#39;node0&#39;</span> up with <span style="color:#e6db74">&#39;libvirt&#39;</span> provider...
Bringing machine <span style="color:#e6db74">&#39;node1&#39;</span> up with <span style="color:#e6db74">&#39;libvirt&#39;</span> provider...
<span style="color:#f92672">==</span>&gt; master: Checking <span style="color:#66d9ef">if</span> box <span style="color:#e6db74">&#39;centos/7&#39;</span> is up to date...
<span style="color:#f92672">==</span>&gt; node1: Checking <span style="color:#66d9ef">if</span> box <span style="color:#e6db74">&#39;centos/7&#39;</span> is up to date...
<span style="color:#f92672">==</span>&gt; node0: Checking <span style="color:#66d9ef">if</span> box <span style="color:#e6db74">&#39;centos/7&#39;</span> is up to date...


<span style="color:#f92672">[</span> . . . <span style="color:#f92672">]</span>


PLAY <span style="color:#f92672">[</span>all<span style="color:#f92672">]</span> *********************************************************************

TASK <span style="color:#f92672">[</span>Gathering Facts<span style="color:#f92672">]</span> *********************************************************
ok: <span style="color:#f92672">[</span>node0<span style="color:#f92672">]</span>
ok: <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span>
ok: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>common : update<span style="color:#f92672">]</span> *********************************************************
changed: <span style="color:#f92672">[</span>node0<span style="color:#f92672">]</span>
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>
changed: <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>wait_for<span style="color:#f92672">]</span> ****************************************************************
ok: <span style="color:#f92672">[</span>master -&gt; localhost<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Create CRD <span style="color:#66d9ef">for</span> the CSIDriverRegistry feature<span style="color:#f92672">]</span> ****************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Create CRD <span style="color:#66d9ef">for</span> the CSINodeInfo feature<span style="color:#f92672">]</span> **********************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>wait_for<span style="color:#f92672">]</span> ****************************************************************
ok: <span style="color:#f92672">[</span>master -&gt; localhost<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Set CSI LVM controller<span style="color:#f92672">]</span> **************************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>wait_for<span style="color:#f92672">]</span> ****************************************************************
ok: <span style="color:#f92672">[</span>master -&gt; localhost<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Start CSI LVM nodes<span style="color:#f92672">]</span> *****************************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Create LVM Storage Class<span style="color:#f92672">]</span> ************************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>wait_for<span style="color:#f92672">]</span> ****************************************************************
ok: <span style="color:#f92672">[</span>master -&gt; localhost<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Create LVM Snapshot Storage Class<span style="color:#f92672">]</span> ***************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Set CSI Ceph controller<span style="color:#f92672">]</span> *************************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Start CSI Ceph nodes<span style="color:#f92672">]</span> ****************************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Create Ceph Storage Class<span style="color:#f92672">]</span> ***********************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Create Ceph Snapshot Storage Class<span style="color:#f92672">]</span> **************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>wait_for<span style="color:#f92672">]</span> ****************************************************************
ok: <span style="color:#f92672">[</span>master -&gt; localhost<span style="color:#f92672">]</span>

TASK <span style="color:#f92672">[</span>Change Ceph default features<span style="color:#f92672">]</span> ********************************************
changed: <span style="color:#f92672">[</span>master<span style="color:#f92672">]</span>

PLAY RECAP *********************************************************************
master                     : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">69</span>   changed<span style="color:#f92672">=</span><span style="color:#ae81ff">57</span>   unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
node0                      : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">22</span>   changed<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>   unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
node1                      : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">22</span>   changed<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>   unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span></code></pre></div>
<p>Now we go into the infrastructure <code>master</code> node to check our deployment:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ vagrant ssh master


<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get pod csi-controller-0 csi-rbd-0
NAME               READY   STATUS    RESTARTS   AGE
csi-controller-0   <span style="color:#ae81ff">6</span>/6     Running   <span style="color:#ae81ff">0</span>          8m50s
NAME               READY   STATUS    RESTARTS   AGE
csi-rbd-0          <span style="color:#ae81ff">7</span>/7     Running   <span style="color:#ae81ff">1</span>          4m12s


Check the logs of the CSI *controller* to see that its running as expected:

<span style="color:#e6db74">```</span>shell
<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl logs csi-controller-0 -c csi-driver
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Ember CSI v0.0.2 with <span style="color:#ae81ff">30</span> workers <span style="color:#f92672">(</span>CSI spec: v1.0.0, cinderlib: v0.3.10.dev4, cinder: v13.1.0.dev902<span style="color:#f92672">)</span>
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Persistence module: CRDPersistence
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Running as controller with backend LVMVolumeDriver v3.0.0
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Debugging feature is ENABLED with ember_csi.rpdb and OFF. Toggle it with SIGUSR1.
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Supported filesystems: cramfs, minix, btrfs, ext2, ext3, ext4, xfs
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Now serving on unix:///csi-data/csi.sock...
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.common <span style="color:#f92672">[</span>req-15807873-3e8a-4107-b41a-6bd63ebdccb8<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC GetPluginInfo
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.common <span style="color:#f92672">[</span>req-15807873-3e8a-4107-b41a-6bd63ebdccb8<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC GetPluginInfo served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.common <span style="color:#f92672">[</span>req-b0ab521b-fd7a-41f6-a03e-3328ebe3a6da<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.common <span style="color:#f92672">[</span>req-b0ab521b-fd7a-41f6-a03e-3328ebe3a6da<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.common <span style="color:#f92672">[</span>req-500d03fb-40d6-4eca-8188-07d2b2d6905c<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC ControllerGetCapabilities
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.common <span style="color:#f92672">[</span>req-500d03fb-40d6-4eca-8188-07d2b2d6905c<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC ControllerGetCapabilities served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-965509cc-2053-4257-afa9-d8d4ea3eeaf1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC GetPluginInfo
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-965509cc-2053-4257-afa9-d8d4ea3eeaf1<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC GetPluginInfo served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-214deb9d-aa3d-44d4-8cb4-7ebadaabfffc<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-214deb9d-aa3d-44d4-8cb4-7ebadaabfffc<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-ef6256e9-4445-481a-b3e9-cdfa0e09a41a<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC GetPluginInfo
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-ef6256e9-4445-481a-b3e9-cdfa0e09a41a<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC GetPluginInfo served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-3ecc4201-423f-4d98-b0c3-4dfedcc111ea<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC GetPluginCapabilities
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-3ecc4201-423f-4d98-b0c3-4dfedcc111ea<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC GetPluginCapabilities served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-de7aec08-b728-432d-be69-27a6ed59d668<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC ControllerGetCapabilities
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:04 default INFO ember_csi.common <span style="color:#f92672">[</span>req-de7aec08-b728-432d-be69-27a6ed59d668<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC ControllerGetCapabilities served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:19:49 default INFO ember_csi.common <span style="color:#f92672">[</span>req-cc8dbfe3-7d92-48b6-9fea-b19f4e635fae<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:19:49 default INFO ember_csi.common <span style="color:#f92672">[</span>req-cc8dbfe3-7d92-48b6-9fea-b19f4e635fae<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:19 default INFO ember_csi.common <span style="color:#f92672">[</span>req-6838a1e3-a7d5-4689-a71f-399a21930788<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:19 default INFO ember_csi.common <span style="color:#f92672">[</span>req-6838a1e3-a7d5-4689-a71f-399a21930788<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:22:49 default INFO ember_csi.common <span style="color:#f92672">[</span>req-212bb19e-3e0a-46ce-9a66-32eaca2c15e4<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:22:49 default INFO ember_csi.common <span style="color:#f92672">[</span>req-212bb19e-3e0a-46ce-9a66-32eaca2c15e4<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:24:19 default INFO ember_csi.common <span style="color:#f92672">[</span>req-cbb20af4-5eb6-4e1a-a8ea-0132022f8c48<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:24:19 default INFO ember_csi.common <span style="color:#f92672">[</span>req-cbb20af4-5eb6-4e1a-a8ea-0132022f8c48<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s


<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl logs csi-rbd-0 -c csi-driver
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:15 rbd INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Ember CSI v0.0.2 with <span style="color:#ae81ff">30</span> workers <span style="color:#f92672">(</span>CSI spec: v1.0.0, cinderlib: v0.3.10.dev4, cinder: v13.1.0.dev902<span style="color:#f92672">)</span>
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:15 rbd INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Persistence module: CRDPersistence
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:15 rbd INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Running as controller with backend RBDDriver v1.2.0
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:15 rbd INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Debugging feature is ENABLED with ember_csi.rpdb and OFF. Toggle it with SIGUSR1.
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:15 rbd INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Supported filesystems: cramfs, minix, btrfs, ext2, ext3, ext4, xfs
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:15 rbd INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Now serving on unix:///csi-data/csi.sock...
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-f261da91-6b20-48a8-9a5c-26cd16b6ab13<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC GetPluginInfo
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-f261da91-6b20-48a8-9a5c-26cd16b6ab13<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC GetPluginInfo served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-503b6596-f408-4b91-94be-63557ef1ffa8<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC GetPluginInfo
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-503b6596-f408-4b91-94be-63557ef1ffa8<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC GetPluginInfo served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-4664c4d5-407e-4e78-91d2-ad2fef3c8176<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-4664c4d5-407e-4e78-91d2-ad2fef3c8176<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-4fd5961f-884d-4029-936b-08e98bee41d9<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC ControllerGetCapabilities
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-4fd5961f-884d-4029-936b-08e98bee41d9<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC ControllerGetCapabilities served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-fb6fbddf-e930-45f3-a476-d1a3212c7cfa<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-fb6fbddf-e930-45f3-a476-d1a3212c7cfa<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-3f079fea-f519-401e-b3ff-c0355abf4176<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC GetPluginInfo
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-3f079fea-f519-401e-b3ff-c0355abf4176<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC GetPluginInfo served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-7b0c6db7-e426-460a-beb6-0499becfe3ff<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC GetPluginCapabilities
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-7b0c6db7-e426-460a-beb6-0499becfe3ff<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC GetPluginCapabilities served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-84b46ba5-3b06-4f8d-8295-689795b7a9b9<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC ControllerGetCapabilities
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:21:16 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-84b46ba5-3b06-4f8d-8295-689795b7a9b9<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC ControllerGetCapabilities served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:24:11 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-74bf9abc-80b6-40ca-a032-ff761a389a2d<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:24:11 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-74bf9abc-80b6-40ca-a032-ff761a389a2d<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:25:41 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-a85e05d9-3c71-42f6-8c67-48ac7151667b<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:25:41 rbd INFO ember_csi.common <span style="color:#f92672">[</span>req-a85e05d9-3c71-42f6-8c67-48ac7151667b<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s</code></pre></div>
<p>Now that we have confirmed that the deployment is working (there is no error on the <em>controller</em> logs) we will proceed to test the plugin.  Remember that we set our configuration in <code>ember_lvm_config</code>, so we&rsquo;ll have to use the manifests in the <code>kubeyml/lvm</code> directory.</p>

<p>First let&rsquo;s test the volume creation functionality:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl create -f kubeyml/lvm/05-pvc.yml
persistentvolumeclaim/csi-pvc created</code></pre></div>
<p>Check the PVC an PVs in Kubernetes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get pvc
NAME      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
csi-pvc   Bound    pvc-7db8685b-3066-11e9-aed5-5254002dbb88   1Gi        RWO            csi-sc         9s


<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM             STORAGECLASS   REASON   AGE
pvc-7db8685b-3066-11e9-aed5-5254002dbb88   1Gi        RWO            Delete           Bound    default/csi-pvc   csi-sc                  14s</code></pre></div>
<p>Now that the volume has been created we will try to create a pod that uses this volume:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl create -f kubeyml/lvm/06-app.yml
pod/my-csi-app created</code></pre></div>
<p>Tail the CSI <em>controller</em> plugin logs to see that the plugin exports the volume:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl logs csi-controller-0 -fc csi-driver
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:17:03 default INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Ember CSI v0.0.2 with <span style="color:#ae81ff">30</span> workers <span style="color:#f92672">(</span>CSI spec: v1.0.0, cinderlib: v0.3.10.dev4, cinder: v13.1.0.dev902<span style="color:#f92672">)</span>


<span style="color:#f92672">[</span> . . .<span style="color:#f92672">]</span>

<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:52:49 default INFO ember_csi.common <span style="color:#f92672">[</span>req-d135903b-f89a-4030-a085-5aa0ba3be2be<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:52:49 default INFO ember_csi.common <span style="color:#f92672">[</span>req-d135903b-f89a-4030-a085-5aa0ba3be2be<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:29 default INFO ember_csi.common <span style="color:#f92672">[</span>req-b5388936-239c-4285-896b-29a9e764caa7<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC ControllerPublishVolume 540c5a37-ce98-4b47-83f7-10c54a4777b9
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:31 default INFO ember_csi.common <span style="color:#f92672">[</span>req-b5388936-239c-4285-896b-29a9e764caa7<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC ControllerPublishVolume served in 2s
^C</code></pre></div>
<p>Tail the CSI <em>node</em> plugin logs to see that the plugin actually attaches the volume to the container:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl logs csi-node-qf4ld -fc csi-driver
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:18:46 INFO ember_csi.ember_csi <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Ember CSI v0.0.2 with <span style="color:#ae81ff">30</span> workers <span style="color:#f92672">(</span>CSI spec: v1.0.0, cinderlib: v0.3.10.dev4, cinder: v13.1.0.dev902<span style="color:#f92672">)</span>

<span style="color:#f92672">[</span> . . . <span style="color:#f92672">]</span>

<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:44 default INFO ember_csi.common <span style="color:#f92672">[</span>req-c9ed9f88-920a-432c-9bb3-d8562d21fadf<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:44 default INFO ember_csi.common <span style="color:#f92672">[</span>req-c9ed9f88-920a-432c-9bb3-d8562d21fadf<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:45 default INFO ember_csi.common <span style="color:#f92672">[</span>req-030e7f15-8f75-49d4-8cc6-3e7ec84698a3<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC NodeGetCapabilities
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:45 default INFO ember_csi.common <span style="color:#f92672">[</span>req-030e7f15-8f75-49d4-8cc6-3e7ec84698a3<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC NodeGetCapabilities served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:45 default INFO ember_csi.common <span style="color:#f92672">[</span>req-62b267b9-fcf7-48d1-a450-97519952af1c<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC NodeStageVolume 540c5a37-ce98-4b47-83f7-10c54a4777b9
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:47 default WARNING os_brick.initiator.connectors.iscsi <span style="color:#f92672">[</span>req-62b267b9-fcf7-48d1-a450-97519952af1c<span style="color:#f92672">]</span> iscsiadm stderr output when getting sessions: iscsiadm: No active sessions.

<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:50 default INFO ember_csi.common <span style="color:#f92672">[</span>req-62b267b9-fcf7-48d1-a450-97519952af1c<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC NodeStageVolume served in 5s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:50 default INFO ember_csi.common <span style="color:#f92672">[</span>req-8414718e-6f5a-4eed-84f0-29cbfca3657e<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC NodeGetCapabilities
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:50 default INFO ember_csi.common <span style="color:#f92672">[</span>req-8414718e-6f5a-4eed-84f0-29cbfca3657e<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC NodeGetCapabilities served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:50 default INFO ember_csi.common <span style="color:#f92672">[</span>req-ce8f5d78-b07b-45d0-9c4e-8c89defd5223<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC NodePublishVolume 540c5a37-ce98-4b47-83f7-10c54a4777b9
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:53:50 default INFO ember_csi.common <span style="color:#f92672">[</span>req-ce8f5d78-b07b-45d0-9c4e-8c89defd5223<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC NodePublishVolume served in 0s
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:55:05 default INFO ember_csi.common <span style="color:#f92672">[</span>req-ba73aa46-6bb9-4b27-974a-aa2fa160b8ff<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; GRPC Probe
<span style="color:#ae81ff">2019</span>-02-14 <span style="color:#ae81ff">14</span>:55:05 default INFO ember_csi.common <span style="color:#f92672">[</span>req-ba73aa46-6bb9-4b27-974a-aa2fa160b8ff<span style="color:#f92672">]</span> &lt;<span style="color:#f92672">=</span> GRPC Probe served in 0s
^C</code></pre></div>
<p>Check that the pod has been successfully created:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get pod my-csi-app
NAME         READY   STATUS    RESTARTS   AGE
my-csi-app   <span style="color:#ae81ff">1</span>/1     Running   <span style="color:#ae81ff">0</span>          3m16s</code></pre></div>
<p>Let&rsquo;s now test the snapshot creation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl create -f kubeyml/lvm/07-snapshot.yml
volumesnapshot.snapshot.storage.k8s.io/csi-snap created


<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl describe VolumeSnapshot
Name:         csi-snap
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  snapshot.storage.k8s.io/v1alpha1
Kind:         VolumeSnapshot
Metadata:
  Creation Timestamp:  <span style="color:#ae81ff">2019</span>-02-14T15:00:35Z
  Finalizers:
    snapshot.storage.kubernetes.io/volumesnapshot-protection
  Generation:        <span style="color:#ae81ff">5</span>
  Resource Version:  <span style="color:#ae81ff">4723</span>
  Self Link:         /apis/snapshot.storage.k8s.io/v1alpha1/namespaces/default/volumesnapshots/csi-snap
  UID:               488d1760-3069-11e9-aed5-5254002dbb88
Spec:
  Snapshot Class Name:    csi-snap
  Snapshot Content Name:  snapcontent-488d1760-3069-11e9-aed5-5254002dbb88
  Source:
    API Group:  &lt;nil&gt;
    Kind:       PersistentVolumeClaim
    Name:       csi-pvc
Status:
  Creation Time:  <span style="color:#ae81ff">2019</span>-02-14T15:00:35Z
  Ready To Use:   true
  Restore Size:   &lt;nil&gt;
Events:           &lt;none&gt;</code></pre></div>
<p>Now create a volume from that snapshot:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl create -f kubeyml/lvm/08-restore-snapshot.yml
persistentvolumeclaim/vol-from-snap created


<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get vol
NAME                                   AGE
540c5a37-ce98-4b47-83f7-10c54a4777b9   21m
faa72ced-43ef-45ac-9bfe-5781e15f75da   6s</code></pre></div>
<p>We can now test the detach operation which is triggered when we destroy the container:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl delete -f kubeyml/lvm/06-app.yml
pod <span style="color:#e6db74">&#34;my-csi-app&#34;</span> deleted

<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get VolumeAttachment
No resources found.

<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get conn
No resources found.</code></pre></div>
<p>And finally the deletion of resources, volumes and snapshot:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl delete -f kubeyml/lvm/08-restore-snapshot.yml
<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl delete -f kubeyml/lvm/07-snapshot.yml
<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl delete -f kubeyml/lvm/05-pvc.yml

<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get pvc
No resources found.

<span style="color:#f92672">[</span>vagrant@master ~<span style="color:#f92672">]</span>$ kubectl get VolumeSnapshot
No resources found.</code></pre></div>
<p>Hopefully everything went great and you were able to run all the above commands and validate your backend, but if you run into trouble, here are our troubleshooting recommendations:</p>

<ul>
<li>Double check the configuration.</li>
<li>Carefully read returned error in case there is useful information.</li>
<li>Enable debug logs and check <code>csi-driver</code> container logs in <code>csi-controller-0</code> and <code>csi-node-*</code>.</li>
<li>Come to the <a href="https://kiwiirc.com/client/irc.freenode.net/ember-csi">#ember-csi IRC channel on Freenode</a> and ask for assistance (you can directly ping geguileo).</li>
<li>You can <a href="https://github.com/embercsi/ember-csi/issues/new">create an issue</a> on the project&rsquo;s GitHub&rsquo;s repository.</li>
</ul>

<p>We can enable debug logs by setting <code>ember_debug_logs</code> to <code>true</code> in the <code>global_vars.yml</code> file, bringing the deployment down with <code>./down.sh</code>, redeploying,</p>

<h3 id="final-notes">Final notes</h3>

<p>We understand that going through all these steps to validate a driver is a very inconvenient process, and we are working towards simplifying it by adding cinderlib functional tests to Cinder vendor CI jobs and adding documentation with configuration examples of the different backends that have been validated.</p>

<p>If you run into issues while going through any of the steps you can come by the <a href="https://kiwiirc.com/client/irc.freenode.net/ember-csi">#ember-csi IRC channel on Freenode</a> and we&rsquo;ll be happy to assist you.  If you prefer, you can also <a href="https://github.com/embercsi/ember-csi/issues/new">create an issue</a> on the project&rsquo;s GitHub&rsquo;s repository.</p>

<p>We would love to hear from you if you were able to successfully go through this process using a different backend.  Having the configuration you used, with sensitive data masked, and any additional dependencies would be really useful for the project and other users.  You can report this information on the <a href="https://kiwiirc.com/client/irc.freenode.net/ember-csi">#ember-csi IRC channel on Freenode</a>, <a href="https://github.com/embercsi/ember-csi/issues/new">create an issue</a> providing your configuration and the <code>Dockerfile.custom</code> file contents asking us to update the project&rsquo;s docs and Docker files, or submit a PR with the changes to the docs and the <code>Dockerfile</code> and <code>Dockerfile-release</code> files.</p>

<p>Bringing down the deployment is as easy as running the <code>./down.sh</code> script.</p>

</article>



					
				</div>
			</div>

            
<div id="footer-wrapper">
    <section id="footer" class="container">
        <div class="row">
    <div class="12u">

        
            <div id="copyright">
                &copy; Ember CSI. All rights reserved. Design by geguileo based on <a href="https://curtistimson.co.uk">curttimson</a>'s Hugo port of a <a href="http://html5up.net">HTML5 UP</a> template.  Background image based one from <a href="https://torange.biz/fx/digital-binary-data-futuristic-infographic-background-172436">torange.biz</a>.
            </div>

    </div>
</div>

    </section>
</div>


        </div>

		
<script src="https://ember-csi.io/assets/js/jquery.min.js"></script>
<script src="https://ember-csi.io/assets/js/jquery.dropotron.min.js"></script>
<script src="https://ember-csi.io/assets/js/skel.min.js"></script>
<script src="https://ember-csi.io/assets/js/skel-viewport.min.js"></script>
<script src="https://ember-csi.io/assets/js/util.js"></script>

<script src="https://ember-csi.io/assets/js/main.js"></script>





	</body>
</html>
